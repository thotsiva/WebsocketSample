import uuid
import time
from unittest.mock import patch

from logger.log_manager import LogManager


@patch("logger.log_manager.get_env", return_value="default")
@patch("logger.log_manager.get_config")
def simulate_reassign_flow(mock_get_config, mock_get_env):
    # Mock config data
    mock_get_config.return_value = {
        "pii_fields": []
    }

    correlation_id = str(uuid.uuid4())
    common_kwargs = {
        "correlationId": correlation_id,
        "user": "john.doe",
        "event": "reassignConversationEvent"
    }

    # Start parent span for the flow
    with LogManager.elf.start_span("reassign_conversation_flow") as parent_ctx:

        LogManager.info(
            parent_context=parent_ctx,
            **common_kwargs,
            step="Reassign Flow",
            message="Reassign flow started"
        )

        # Validator steps
        LogManager.info(
            parent_context=parent_ctx,
            **common_kwargs,
            step="Reassign Validator",
            message="Validator started successfully"
        )
        time.sleep(0.2)
        LogManager.info(
            parent_context=parent_ctx,
            **common_kwargs,
            step="Reassign Validator",
            message="Validator ended successfully"
        )

        # Handler steps
        LogManager.info(
            parent_context=parent_ctx,
            **common_kwargs,
            step="Reassign Handler",
            message="Handler started successfully"
        )
        time.sleep(0.2)
        LogManager.info(
            parent_context=parent_ctx,
            **common_kwargs,
            step="Reassign Handler",
            message="Handler ended successfully"
        )

        # Helper steps
        LogManager.info(
            parent_context=parent_ctx,
            **common_kwargs,
            step="Reassign Helper",
            message="Helper started successfully"
        )
        time.sleep(0.2)
        LogManager.info(
            parent_context=parent_ctx,
            **common_kwargs,
            step="Reassign Helper",
            message="Helper ended successfully"
        )

        LogManager.info(
            parent_context=parent_ctx,
            **common_kwargs,
            step="Reassign Flow",
            message="Reassign flow completed"
        )


if __name__ == "__main__":
    simulate_reassign_flow()
